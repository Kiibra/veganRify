<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/products/show.css"/>
<%- include('../partials/nav') %>

<title><%= title %></title>

<h2>Product Detail</h2>
<div class="product-container">

  <div class="product-card">
    <p> <img src="<%= product.imageLink %>" alt="product image for post"></p>
    <h2><%= product.mealName %> - Posted by <%= product.author.name %></h2>
    <p><%= product.description %></p>
    <% if (product.author._id.equals(user.profile._id)) { %>
      <form action="/products/<%= product._id%>?_method=DELETE" method="POST">
        <button class="delete-button">Delete 🗑️</button>
      </form>
      <% } %>
  </div>

  <form action="/products/<%= product._id %>/comments" method="POST">
    <textarea type="text" name="content" placeholder="comment here..."></textarea>
    <button class="comment-button" type="submit">Submit💬</button>
  </form>

  <% if (product.comments.length) { %>
    <p>Comments:</p>
    <ul>
      <% product.comments.forEach(comment => { %>
      <li>
        <%= comment.content %> - <%= comment.author.name%>
        <% if (comment.author._id.equals(user.profile._id)) { %>
          <form action="/products/<%= product._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
            <button class="delete-comment-button" type="submit">X</button>
          </form>
          <a href="/products/<%= product._id %>/comments/<%= comment._id %>/edit"><button>Update Comment</button></a>
          <% } %>
      </li>
      <% }) %>
    </ul>
  <% } else {%>
    <p>Comments will appear here</p>
  <% } %>
</div>
<%- include('../partials/footer') %>